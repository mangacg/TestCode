<!DOCTYPE html>
<html>
<head>
  <title>文字描画 サンプル</title>
  <style>
  #popupimg{
	  position: absolute;
  }
  </style>
</head>
<body>
	<canvas id="canvas" ></canvas>
	<img src="" width="100" id="popupimg">
	<script src="./cv_math.js?v={{ $version_stamp }}"></script>
	<script src="./cv_annotationpopup.js?v={{ $version_stamp }}"></script>	
	<!-- <script src="./drawPopUpSample.js?v={{ $version_stamp }}"></script> -->
	<script>

console.log('Start Sample');

let imgx = 10;
let imgy = 100;

let popUpImage = new CV.AnnotationPopUpImage();
let myimage    = popUpImage.createImage();

let update = function() {
    let img    = document.getElementById('popupimg');
	img.src    = myimage.src;
	img.width  = myimage.width;
	img.height = myimage.height;
	img.style.left = imgx + "pt";
	img.style.top  = imgy + "pt";

	// 背景をクリア.
    let canvas    = document.getElementById('canvas');
    canvas.width  = document.documentElement.clientWidth;
    canvas.height = document.documentElement.clientHeight;
    let ctx       = canvas.getContext('2d');
    ctx.fillStyle = "rgb(128, 128, 128)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
};

let updateVisible = function(isVisible) {
    let img = document.getElementById('popupimg');
	img.style.visibility = isVisible ? "visible" : "hidden";
}

let updatePos = function(x, y) {
    let img        = document.getElementById('popupimg');
	imgx           += x;
	imgy           += y;
	img.style.left = imgx + "pt";
	img.style.top  = imgy + "pt";
}

window.onload = function() {
    console.log('onload');
    update();
};

window.onresize = function() {
    console.log('onresize');
    update();
};

window.onkeydown = (event) => {
    console.log('onkeydown');
	if (event.code === "KeyV") {
		updateVisible(true);
	}
	if (event.code === "KeyH") {
		updateVisible(false);
	}
	if (event.code === "KeyN") {
		updatePos(0, 5);
	}
	if (event.code === "KeyP") {
		updatePos(0, -5);
	}
};

</script>
</body>
</html>
